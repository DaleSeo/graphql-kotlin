"use strict";(self.webpackChunkgraphql_kotlin_docs=self.webpackChunkgraphql_kotlin_docs||[]).push([[7655],{1318:(e,o,t)=>{t.r(o),t.d(o,{assets:()=>c,contentTitle:()=>l,default:()=>m,frontMatter:()=>a,metadata:()=>p,toc:()=>u});var n=t(87462),i=t(63366),r=(t(67294),t(3905)),s=(t(95657),["components"]),a={id:"ktor-subscriptions",title:"Subscriptions"},l=void 0,p={unversionedId:"server/ktor-server/ktor-subscriptions",id:"server/ktor-server/ktor-subscriptions",title:"Subscriptions",description:"_To see more details on how to implement subscriptions in your schema, see the schema generator docs on executing subscriptions.",source:"@site/docs/server/ktor-server/ktor-subscriptions.md",sourceDirName:"server/ktor-server",slug:"/server/ktor-server/ktor-subscriptions",permalink:"/graphql-kotlin/docs/7.x.x/server/ktor-server/ktor-subscriptions",draft:!1,editUrl:"https://github.com/ExpediaGroup/graphql-kotlin/tree/master/website/docs/server/ktor-server/ktor-subscriptions.md",tags:[],version:"current",lastUpdatedBy:"Samuel Vazquez",lastUpdatedAt:1685659104,formattedLastUpdatedAt:"Jun 1, 2023",frontMatter:{id:"ktor-subscriptions",title:"Subscriptions"},sidebar:"docs",previous:{title:"Ktor Plugin Configuration",permalink:"/graphql-kotlin/docs/7.x.x/server/ktor-server/ktor-configuration"},next:{title:"Client Overview",permalink:"/graphql-kotlin/docs/7.x.x/client/client-overview"}},c={},u=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Flow Support",id:"flow-support",level:2},{value:"WebSocket Sub-protocols",id:"websocket-sub-protocols",level:2},{value:"Subscription Execution Hooks",id:"subscription-execution-hooks",level:2},{value:"<code>onConnect</code>",id:"onconnect",level:3},{value:"<code>onOperation</code>",id:"onoperation",level:3},{value:"<code>onOperationComplete</code>",id:"onoperationcomplete",level:3},{value:"<code>onDisconnect</code>",id:"ondisconnect",level:3},{value:"Example",id:"example",level:2}],d={toc:u},k="wrapper";function m(e){var o=e.components,t=(0,i.Z)(e,s);return(0,r.kt)(k,(0,n.Z)({},d,t,{components:o,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"To see more details on how to implement subscriptions in your schema, see the schema generator docs on ",(0,r.kt)("a",{parentName:"em",href:"/graphql-kotlin/docs/7.x.x/schema-generator/execution/subscriptions"},"executing subscriptions"),".\nThis page lists the ",(0,r.kt)("inlineCode",{parentName:"em"},"graphql-kotlin-ktor-server")," specific features.")),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("p",null,"To start using Subscriptions, you may need install ",(0,r.kt)("a",{parentName:"p",href:"https://ktor.io/docs/websocket.html"},"WebSockets")," plugin to your Ktor server config."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin"},"install(WebSockets)\n")),(0,r.kt)("p",null,"See ",(0,r.kt)("a",{parentName:"p",href:"https://ktor.io/docs/websocket.html#configure"},"plugin docs")," to get more info about the ",(0,r.kt)("inlineCode",{parentName:"p"},"WebSocketOptions")," configuration."),(0,r.kt)("h2",{id:"flow-support"},"Flow Support"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"graphql-kotlin-ktor-server")," provides support for Kotlin ",(0,r.kt)("inlineCode",{parentName:"p"},"Flow")," by automatically configuring schema generation process with ",(0,r.kt)("inlineCode",{parentName:"p"},"FlowSubscriptionSchemaGeneratorHooks"),"\nand GraphQL execution with ",(0,r.kt)("inlineCode",{parentName:"p"},"FlowSubscriptionExecutionStrategy"),"."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"If you define your subscriptions using Kotlin ",(0,r.kt)("inlineCode",{parentName:"p"},"Flow"),", make sure to extend ",(0,r.kt)("inlineCode",{parentName:"p"},"FlowSubscriptionSchemaGeneratorHooks")," whenever you need to provide some custom hooks.")),(0,r.kt)("h2",{id:"websocket-sub-protocols"},"WebSocket Sub-protocols"),(0,r.kt)("p",null,"We have implemented subscriptions in Ktor WebSockets following the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/enisdenjo/graphql-ws/blob/master/PROTOCOL.md"},(0,r.kt)("inlineCode",{parentName:"a"},"graphql-transport-ws"))," sub-protocol.\nThis one is enabled by default if you don't override the config:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin"},"install(Routing) {\n    graphQLSubscriptionsRoute()\n}\n")),(0,r.kt)("p",null,"If you would like to implement your own subscription handler, e.g. to support another sub-protocol, you can provide your implementation to the ",(0,r.kt)("inlineCode",{parentName:"p"},"graphQLSubscriptionsRoute"),"\nas shown below:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin"},"install(Routing) {\n    graphQLSubscriptionsRoute(handlerOverride = MyOwnSubscriptionsHandler())\n}\n")),(0,r.kt)("h2",{id:"subscription-execution-hooks"},"Subscription Execution Hooks"),(0,r.kt)("p",null,'Subscription execution hooks allow you to "hook-in" to the various stages of the connection lifecycle and execute custom logic based on the event. By default, all subscription execution hooks are no-op.\nIf you would like to provide some custom hooks, you can do so by providing your own implementation of ',(0,r.kt)("inlineCode",{parentName:"p"},"KtorGraphQLSubscriptionHooks"),"."),(0,r.kt)("h3",{id:"onconnect"},(0,r.kt)("inlineCode",{parentName:"h3"},"onConnect")),(0,r.kt)("p",null,"Allows validation of connectionParams prior to starting the connection.\nYou can reject the connection by throwing an exception.\nA ",(0,r.kt)("inlineCode",{parentName:"p"},"GraphQLContext")," returned from this hook will be later passed to subsequent hooks."),(0,r.kt)("h3",{id:"onoperation"},(0,r.kt)("inlineCode",{parentName:"h3"},"onOperation")),(0,r.kt)("p",null,"Called when the client executes a GraphQL operation."),(0,r.kt)("h3",{id:"onoperationcomplete"},(0,r.kt)("inlineCode",{parentName:"h3"},"onOperationComplete")),(0,r.kt)("p",null,"Called when client's unsubscribes"),(0,r.kt)("h3",{id:"ondisconnect"},(0,r.kt)("inlineCode",{parentName:"h3"},"onDisconnect")),(0,r.kt)("p",null,"Called when the client disconnects"),(0,r.kt)("h2",{id:"example"},"Example"),(0,r.kt)("p",null,"You can see an example implementation of a ",(0,r.kt)("inlineCode",{parentName:"p"},"Subscription")," in the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/ExpediaGroup/graphql-kotlin/blob/master/examples/server/ktor-server/src/main/kotlin/com/expediagroup/graphql/examples/server/ktor/schema/ExampleSubscriptionService.kt"},"example app"),"."))}m.isMDXComponent=!0}}]);